#!/usr/bin/env bash
# tc - Create or attach to a tmux session named after the current directory.
# Usage: tc [session-name]

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
# shellcheck source=lib/common.sh
source "$SCRIPT_DIR/lib/common.sh"

if [[ "${1:-}" == "-h" || "${1:-}" == "--help" ]]; then
    echo "Usage: tc [session-name]"
    echo ""
    echo "Create or attach to a tmux session."
    echo "Defaults to the current directory name if no session name is given."
    exit 0
fi

PATH=/opt/homebrew/bin:$PATH

require_command "tmux" "brew install tmux"

SESSION_NAME="${1:-$(basename "$(pwd)")}"

if tmux has-session -t "$SESSION_NAME" 2>/dev/null; then
    info "Attaching to session '$SESSION_NAME'..."
    tmux attach-session -t "$SESSION_NAME"
else
    info "Creating session '$SESSION_NAME'..."
    tmux new-session -s "$SESSION_NAME"
fi
